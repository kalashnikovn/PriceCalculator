# PriceCalculator

## Описание сервиса
Сервис выполняет расчет стоимости доставки грузов на расстояние 1км. Расчет осуществляется на основе массогабаритных показателей.
Метод **POST /v1/delivery-prices/calculate** принимает запрос от пользователя `UserId`, содержащий массив товаров, описанных габаритами и массой:
- длина (length), м
- ширина (width), м
- высота (height), м
- масса (weight), кг

По данным параметрам производится вычисление стоимости доставки на основе габаритов и на основе веса, итоговое значение - максимальная стоимость из двух.
Товары, участвующие в расчете, и сам расчет сохраняется в БД с привязкой к пользователю.

Метод **POST /v1/delivery-prices/get-history** позволяет получить расчеты, которые производил пользователь `UserId`. Метод позволяет получать расчеты диапазоном, где `Take` &mdash; сколько расчетов необходимо вернуть, `Skip` &mdash; сколько расчетов необходимо пропустить. `CalculationIds` &mdash; фильтр по конкретным ID расчетов пользователя .Расчеты отсортированы по убыванию - от самого последнего к самому раннему. 

Метод **POST /v1/delivery-prices/clear-history** позволяет пользователю частично или полностью очистить свою историю расчетов вместе с товарами.

## Kafka
### GoodPriceCalculatorHostedService

Background-сервис, который читает топик `good_price_calc_requests` с входящими параметрами, аналогичными тем, что есть в последней версии API. Результаты расчетов для товаров записываются в топик `good_price_calc`. В случае, если приходят невалидные сообщения, они корректно обрабатываются и отправляются в `good_price_calc_requests_dlq`.


### AnomalyFinderHostedService

Hosted-сервис для чтения результатов из топика `good_price_calc` и нахождения **аномальных** расчетов стоимости доставки товаров. Найденные аномалии сохраняются в БД.  


### Kafka Producer App

Консольное приложение, которое наполняет топик `good_price_calc_requests` актуальными товарами. Количеством генерируемых товаров можно управлять через входные данные


## gRPC

### gRPC API

Помимо JSON API в сервисе также реализовано gRPC API, а именно:

- Унарный метод для расчета цены доставки товаров. Метод принимает запрос от пользователя (UserId), содержащий массив товаров, описанных габаритами и массой
- Унарный метод удаления результата расчета. На вход UserId и массив идентификаторов расчетов для удаления.
- Server-streaming метод для получения истории расчетов. На вход UserId, ответ - стрим с историей расчетов, отсортированных от новых к старым.
- Bidirectional streaming метод (аналог обычного метода для расчета)

### gRPC Client App

- Название метода вводится в консоль.
- Для унарных методов параметры вводятся в консоль.
- Если нужно стримить с клиента, то в качестве параметра передается имя файла с запросами.
- Ответы сервиса выводятся на консоль.